# УПРАВЛЕНИЕ ДАННЫМИ

Литература

1. Кузнецов С.Д. Введение в реляционные базы данных. - М.: НОУ "Интуит", 2016, 248 с.
2. Карпова Т.С. БД, модели, разработки, реализация - М.: НОУ "Интуит", 2016, 403 с.
3. Маклаков С.В. Создание информационных систем с ALLFusion Model Suite. - М.: Диалог, МИФИ, 2013, 396 с.
4. Пржиялковский В.В. Введение в ORACLE SQL - М.: НОУ "Интуит", 2016, 358 с.
5. Мишра С., Бьюли А. Секреты Oracle SQL - СПб: Символ-Плюс, 2016, 368 с.

# 1 Системный анализ предметной области

- База данных (БД) и система управления базой данных (СУБД)
- Предметная область и ее описание
- Инфологическое моделирование
- Датологическое моделирование
- Ключи (простой и составной, потенциальный первичный и вторичный, суррогатный)

## 1.1 База данных (БД) и система управления базой данных (СУБД)

ИС включает БД и СУБД

**База данных (БД)** - именованная совокупность данных, отражающая состояние объектов и их отношений в рассматриваемой предметной области.

**Система управления базами данных (СУБД)** - совокупность языковых и программных средств, предназначенных для создания, ведения и совместного использования БД многими пользователями.

Растущий объем информации -> специальные программные комплексы - СУБД

Основная особенность СУБД - наличие процедур для ввода и хранения не только самих данных, но и описаний их структуры.

Файлы с описанием хранимых в них данных и находящиеся под управлением СУБД -> банки данных -> Базы данных (БД).

Язык запросов СУБД позволяет обращаться за данными как из программ, так и с терминалов

СУБД позволяют:

- постоянно хранить сколько угодно большие (но не бесконечные) объемы данных;
- извлекать и изменять эти хранящиеся данные в том или ином аспекте, используя при этом так называемые запросы;
- создавать новые базы данных, т.е. описывать логические структуры данных и задавать их структуру, т.е. предоставляют интерфейс программирования;
- обращаться к хранящимся данным со стороны нескольких пользователей одновременно (т.е. предоставляют доступ к механизму управления транзакциями).

**Базы Данных** - наборы данных под контролем систем управления.

**СУБД** - программно-техническая система для:

- разработки баз данных;
- поддержания их в работоспособном состоянии и обеспечения безопасности хранимой информации.

СУБД в основном, основаны на иерархических, сетевых и реляционных моделях данных.

В процессе развития в 1970 появились системы управления базами данных, основанные на реляционной модели данных.

## 1.2 Предметная область и ее описание

**Предметная область (ПО)** - область применения конкретной БД (в сфере управления предприятиями и организациями, транспортом, в медицине, научных исследованиях и т.п.)

При определении границ ПО используют

- подход "от реального мира", когда с помощью экспертов определяются границы ПО.
- подход "от запросов пользователей" используется для уточнения границ ПО и наибольшее применение он получает в период использования ИС, когда накапливается достаточно информации о содержании запросов и необходимо выполнить коррекцию границ ПО и состава информационной модели.

**Объект** - это то, о чем должна накапливаться информация.

Выбор объектов осуществляется в соответствии с целевым назначением.

Объекты могут быть атомарными или составными.

- **Атомарный объект** - объект определенного типа, дальнейшее разложение которого на более мелкие объекты внутри данного типа невозможно.
- **Составные объекты** включают в себя множества объектов.

Состояние объекта описывается с помощью ограниченного набора свойств и связей с другими объектами.

Свойства объекта могут не зависеть от его связей с другими объектами, то есть являются локальными.

Если свойства объекта зависят от его связей с другими объектами, то они являются реляционными.

Каждая связь между объектами по числу входящих в нее объектов характеризуется степенью n=2,3,...,k (бинарная, k-арная).

Чтобы отобразить объекты в информационную сферу, необходимо определить:

- какие объекты важны для данного применения;
- какие свойства могут иметь эти объекты;
- какие связи существуют между объектами;
- какие имена можно присвоить отдельным составляющим объектной системы.

Задача. Каждый филиал страховой компании характеризуется названием, адресом и телефоном. В компанию обращаются различные лиц с целью заключения договора о страховании по определенном виду страхования (от угона автотранспорта, страховании домашнего имущества, ДМС). В договоре фиксируется дата заключения, страховая сумма, филиал, в котором заключается договор.

Страховая компания делает ИС для себя.  
Объекты (то, о чем собираем информацию)  
Филиал, клиент, договор, виды страхования.  
Филиал характеризуется названием, адресом и телефоном  
Названия филиалов уникальны  
Филиалы располагаются в разных городах  
Каждый филиал имеет сотрудников для заключения договоров, работающих в одном отделе  
Виды услуг. В каждом филиале заключаются договоры по всем видам услуг  
Клиент характеризуется ФИО, паспорт, адрес  
Клиенты проживают в разных городах и могут заключать договоры в разных филиалах фирмы  
Договор описывается номером, датой заключения, страховой суммой  
Договор заключается между филиалом, который представлен его сотрудником, и клиентом.  
Договор заключается на один вид страхования на определенный срок  
Виды страхования характеризуются названием, периодом, стоимостью страховой суммой.  
Виды запросов - определение суммарной стоимости заключенных договоров по клиентам, по филиалам, определение среднего возраста клиентов и др.

## Д/З - Дать описание предметной области

1. Ателье производит пошив детских изделий из трикотажа. Закройщики обращаются на склад и получают необходимый материал (ткань, пуговицы, нитки, тесьму) по накладной, в которой указывается выданный материал, его количество, стоимость, кому выдано и когда.
2.  База данных должна содержать данные о контингенте студентов (фамилия, имя, отчество, год поступления, форма обучения(дневная/вечерняя/заочная), номер или название группы);  журнале успеваемости студентов (студент, дисциплина, оценка).

## 1.3 Инфологическое моделирование

Инфологическое моделирование - создание структурированной информационной модели предметной области.

Требование к модели:

1. обеспечение понятного для человека способов сбора и представления информации
2. корректность схемы БД - адекватное отображение предметной области
3. простота и удобство использования на последующих этапах (поддерживает сетевые, иерархические, реляционные и другие модели данных)
4. язык описания понятен проектировщикам, программистам, администраторам БД и пользователям.

Инфологическая модель дает информацию о предметной области не зависимо от используемой СУБД

Инфологическая=Концептуальная=Семантическая=Логическая

1976 - Питер Чен - Модель "сущность-связь"

Основные компоненты модели:

- сущности
- атрибуты
- связи

Сущность - некая абстракция реально существующего предмета, объекта или явления (люди, самолеты, рейсы, сотрудники, города)

Тип сущности - набор однородных предметов, событий, личностей, выступающих одним целым.

(Сущность: город - название, население, река или название, площадь)

Экземпляр сущности относится к конкретному объекту.

Атрибут - поименованная характеристика сущности

Для его задания надо

1. присвоить ему имя/наименование 
2. присвоить смысловое описание
3. определить множество допустимых значений
4. указать для чего он используется

Имена атрибутов должны быть уникальны для конкретного вида сущности.

Каждому экземпляру сущности присваивается только одно значение атрибута.

Атрибут может выступать как самостоятельная сущность.

Атрибут используется:

1. для описания свойства сущности
2. для идентификации/распознавания конкретного вида сущности (ключ)
3. для представления связи между сущностями (внешний ключ)

Ключ - минимальный набор атрибутов по значениям которых можно однозначно найти требуемый экземпляр сущности.

Ключ может быть составным.

Связь - средство представления отношений между сущностями (ассоциирование двух или более сущностей)

Одно из требований к организации БД - обеспечение возможности отыскания одних экземпляров сущности по значениям других.

Могут встречаться:

- бинарные связи (между двумя)
- тернарные (между тремя)
- n-арные (n-степень связи, арность связи)

Суть инфологического моделирования:

1. выделение сущностей
2. определение их атрибутов
3. определение взаимосвязей между сущностями

Графическое представление инфологической модели носит название ER-диаграмма.

Нотация - система обозначений для графического представления ER-диаграмм.

Нотация Чена

- сущности изображаются прямоугольниками
- отношения между связями - ромбами ???
- если сущность участвует в отношении, то ромб и прямоугольник соединяются линиями
- атрибуты представляются овалами и связываются линиями с одной сущностью.

Нотация IE (Information Engineering)

- сущность - прямоугольник, в котором изображаются атрибуты
- ключевой атрибут располагается в верхней части и отделяется чертой, остальные атрибуты идут ниже
- связи отображаются линиями
  + один-к-одному -|---|-
  + один-ко-многим -|---|<
  + многие-ко-многим >|---|<
- каждая связь имеет 2 конца и 1-2 наименования, которые отображаются в виде глагола

Например: иметь

Существует два подхода к инфологическому проектированию:

1. анализ объектов (нисходящий подход)
2. синтез свойств/атрибутов (восходящий подход)

Задача №1

 - объектами ставим соответствующие сущности

Сущности: Филиал, Город, Сотрудники, Договор, вид_страх

Сущность Филиал имеет атрибуты: назв, адр, тел

- назв - ключевой атрибут
- адр - составной атрибут (город, улица, дом). Выделяем в сущность
- город (название, код города) код_гор - ключ

Сущность Сотруд (таб_н, ф, и, о, дата_рож, дата_нач_раб)

Сущность Договор (номер, дата)

Связи:
Филиал-город (многие-к-одному)  
Филиал-сотр (один-ко-многим)  
Филиал-договор(один-ко-многим)  
Сотр-договор(дополнить описание предметной области - один сотр-к готовит много договоров, по 1 договор готовит только 1 сотрудник) (один-ко-многим)  
Договор-вид страхования (1 договор на 1 вид услуги, но 1 услуга во многих договорах)(многие-к-одному)  

Сущность Клиент имеет атрибуты: Фк, Ик, Ок, паспорт, улица, дом

- Ключ атрибут - паспорт

Клиент-договор (один-ко-многим)
Клиент-город(многие-к-одному)

## 1.4 Даталогическое моделирование (иерархическая, сетевая, реляционная МД)

Даталогическая модель поддерживается конкретной СУБД

Даталогическая модель представляет данные в виде иерархии и выражает отношения подчинения

Граф-совокупность точек и связывающих дуг (не имеет циклов, петель, висячих вершин)

### Иерархическая модель отражает граф в виде дерева

- Вершины графа - типы сущностей
- Дуги - типы связей между ними

### Сетевая модель

Сетевая модель использует представление данных в виде произвольного графа (петли и циклы могут быть)

- в узлах - типы записей
- в ребрах - связи между типами записи

### Реляционная модель

Реляционная модель данных - это организация данных в виде двумерных таблиц

Строки - записи  
Столбцы - поля

Данные в таблице удовлетворяют следующим требованиям:

- каждое значение на пересечении строки и столбца должно быть атомарным (простым)
- значение данных в одном и том же столбце должны принадлежать к одному и тому же типу.
- каждая запись в таблице уникальна
- каждое поле в таблице имеет уникальное имя
- последовательность полей (столбцов) несущественна
- последовательность записей несущественна
- поле, указывающие на запись в другой таблице, связанное с данной записью, называется внешним ключом

Достоинства

- простота
- понятность
- удобство реализации на компьютере

## 1.5 Понятие ключей

При объявлении таблицы могут быть заданы несколько ключей

Ключ - один или несколько столбцов (полей) таблицы, для которых объявлено условие уникальности значений в строках таблицы

уникальность столбца ??? неповторимость значений в этом столбце

Условие ???

1. простой ключ - ключ, состоящий из одного и не более столбцов
2. составной ключ - ключ, состоящий из двух и более полей (столбцов)
3. суперключ таблицы - один или несколько столбцов, которые позволяют однозначно отличить одну запись таблицы от другой. На суперключ не накладывается требование минимальности. Суперключ - любое надмножество любого ключа. Сама схема (заголовок) таблицы заведомо является суперключом
4. потенциальный ключ - один или несколько столбцов, которые позволяют однозначно отличить одну запись таблицы от другой и при этом среди них не содержится другой набор столбцов, обладающих таким же свойством
5. первичный ключ - это тот потенциальный ключ, который выбран для реализации в таблице, Primary Key (PK)  
Важно, что
   + допустимо объявление одно и только одного первичного ключа
   + столбцы первичного ключа ни в коем случае не могут принимать Null-значений. Значение NULL указывает на то, что данные неизвестны, неприменимы или что будут добавлены позже
   + Каждая таблица должна содержать первичный ключ (???)  
Основные отличия потенциальных ключей от ключей первичных:
   + потенциальных ключей может быть несколько, тогда как первичный ключ, может быть только один
   + если значения первичного ключа не могут быть Null-значений, то на потенциальные ключи это условие не накладывается.  
Как выбрать первичный ключ из набора потенциальных?
   + ключ должен содержать как можно меньше столбцов, чтобы быстродействие системы поиска было выше
   + максимальное количество байт информации в столбцах выбранного ключа должно быть как можно меньше
   + надо стремиться к числовому типу данных в ключе (быстрее обработка)
   + столбцы ключа не должны допускать отсутствие информации в ячейках
   + информация ключа не должна изменяться (изменение данных ключа не должно допускаться)
6. внешний ключ - ключ, объявленный в таблице, который при этом ссылается на первичный или потенциальный ключ той же самой или другой таблицы. Таблица, на которую ссылается внешний ключ, называется ссылочной (родительской) таблицей или главной. Таблица содержащая внешний ключ, называется дочерней. Внешний ключ обозначается как Foreign Key (FK)
7. потенциальные ключ, которые не выбраны в качестве первичного, называют альтернативными (Alternative Key - AK)
8. суррогатный ключ - искусственный ключ без смысловой нагрузки  
Таблица, к ???

## 1.6 Виды связи

Будем говорить, что некоторая запись таблицы А связана с некоторой записью таблицы В, если в обеих таблицах эти записи содержат одно и то же значение в поле, по которому установлена связь между таблицами.

Виды связей

- бинарные между двумя таблицами - соединяют 2 таблицы
- унарные - соединяют таблицу с собой

Различают 4 типа бинарных связей (отношений) между таблицами реляционной базы данных:

- связь "один-к-одному" (1-1)
- связь "один-ко-многим" (1-М)
- связь "многие-к-одному" (М-1)
- связь "многие-ко-многим" (М-М)

- связь 1:1 (один к одному) - это такая связь между таблицами А и В, когда каждой записи таблицы А соответствует не более одной записи таблицы В и наоборот ???

Запись в нотации IE (Information Engineering)

- A -|---|- B каждой записи таблицы А соответствует 1 запись в таблице В и наоборот
- А -|о---о|- В каждой записи таблицы А соответствует 1 или 0 записей таблицы В и наоборот
- А 1---1 В так записывается связь в Access

Применение связи 1:1 предпочтительно в основном для функционального разделения ???

- связь 1:М (один ко многим) - это такой вид связи между таблицами А и В, когда каждой записи таблицы А соответствует 0, 1 или несколько записей таблицы В, но каждой записи таблицы В соответствует не более одной записей из таблицы А (1 или 0)

Таблица А называется главной таблицей, а таблица В - подчиненной.

Каждая связь может иметь одну из двух модальностей:

- (может) запись одной таблицы может быть связана с одной или несколькими записями другой, а может быть и не связана ни с одной
- (должна) запись одной таблицы обязана быть связана не менее чем с одной записью другой

Связь может иметь разную модальность с разных концов.

Необязательность связи (может) -> пустой кружочек на конце  
???

Отношение один-ко-многим - основной тип отношений при проектировании современных БД.

Одной записи в родительской таблице соответствуют 0,1,2,...N записей в дочерней.

Отношения один-ко-многим могут быть жесткими и нежесткими  
Для жестких отношений, каждой связи родительской таблицы должна соответствовать хотя бы одна запись дочерней

Связи 1:М в реляционной модели устанавливаются через введение в таблицах дополнительных полей, которые дублируют ключевые поля связанной таблицы.

Связь М:1 (многие к одному) - это отношение которое является обратным отношению 1:М

Связь М:М это такая связь между таблицами А и В когда каждой записи таблицы А соответствует 0,1 или несколько записей таблицы В и наоборот

Реализуется введением таблицы (ассоциативной), где должно быть по меньшей мере 2 столбца

- 1-й соответствует первичному ключу таблицы А
- 2-й соответствует первичному ключу таблицы В

Унарная связь - связь таблицы с собой.

Рекурсивная связь появляется, когда одна и та же сущность выступает неоднократно в разных ролях (часто используется для хранения данных древовидной структуры)

При задании рекурсивной связи первичной ключ родительской таблицы (которая одновременно выступает и в роли дочерней) должен мигрировать в качестве внешнего ключа в состав обязательно неключевых атрибутов (полей) этой таблицы.

Null-значения у внешнего ключа допустимы?

Важно - атрибуты не могут появляться дважды в одной и той же таблице под одним и тем же именем. Мигрированный ключ обязательно должен получить другое имя

Сетевая рекурсия

У одного сотрудника может быть несколько начальников по разным областям деятельности (производственная, партийная, профсоюзная)

Связь в этом случае многие-ко-многим и реализуется через дополнительную таблицу

Сетевая рекурсия представляет собой рекурсивную связь типа "многие-ко-многим" и предназначена ???

Неидентифицирующая и идентифицирующая связь

Связи бывают 1:1, 1:М, М:1, М:М

Связь, когда вторичный ключ попал в список неключевых атрибутов - неидентифицирующая связь и обозначается пунктиром

Связь, когда вторичный ключ попадается в атрибуты первичного ключа второй сущности называется идентифицирующей и обозначается линией.

На уровне инфологической модели разрешается связь супертип-подтип

В реальной модели эта связь преобразуется в 2 связи 1:1 -> 3 таблицы попарно связанных

Исходная сущность Сотрудник несет в себе отношение включения или часть-целое

- из исходной сущности выделяют общие атрибуты и сущность, которая становится супертипом
- выявляют некоторый атрибут значения которого порождают разбиение множества экземпляров исходной сущности на непересекающиеся подмножества - подтипы сущности

Супертип с порожденными им подтипами - пример составной сущности

## 1.7 Целостность данных

Целостность баз данных - это механизм поддержания соответствия базы данных предметной области (корректности и непротиворечивости данных в системе)

Целостность реляционной модели касается

- целостность таблиц
- целостность ссылок

Требование целостности таблиц заключается в

- отсутствие строк-дубликатов (отсутствие дубликатов по полям первичных ключей, что не исключает совпадения значений других полей)
- отсутствие полей с множественным характером значений, что обеспечивается нормализацией таблиц
- введение ограничений на значения

Требования целостности ссылок

- для любой записи с конкретным значением внешнего ключа должен обязательно существовать запись связанной таблицы с соответствующим значением первичного ключа
- удаление записи главной таблицы, первичный ключ которой совпадает со значением вторичного ключа, невозможно

Основное назначение связей - поддержание целостности БД

- нельзя внести в подчиненную таблицу запись, которая будет содержать в поле вторичного ключа, значение, которого нет среди значений первичного ключа главной таблицы
- в подчиненной таблице нельзя изменить поле вторичного ключа на такое, которого нет среди значений первичного ключа, главной таблицы
- из главной таблицы (если не установлен специальный режим работы связи) нельзя удалить запись, которая имеет такое значение первичного ключ, которое есть среди значений вторичного ключа подчиненной таблицы
- у главной таблицы (если не установлен специальный режим) нельзя изменить значение первичного ключа, если это значение присутствует в столбце вторичного ключа подчиненной таблицы

Специальные режимы работы связи

- Режим каскадного удаления (при удалении записи из главной таблицы, автоматически удаляются все связанные записи из подчиненной таблицы)
- Автоматическая установка значения NULL - при удалении записи из главной таблицы, в столбец вторичного ключа, соответствующей строки проставляется Null
- Каскадное обновление (изменение) при изменении первичного ключа главной таблицы, автоматически изменяются соответствующие значения в столбце вторичного ключа подчиненной таблицы
